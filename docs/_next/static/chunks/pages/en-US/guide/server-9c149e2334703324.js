(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9618],{2024:function(e,i,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/en-US/guide/server",function(){return r(1509)}])},1509:function(e,i,r){"use strict";r.r(i),r.d(i,{default:function(){return HOC},useTOC:function(){return useTOC}});var s=r(5893),n=r(7812),t=r(1054),a=r(8925);function useTOC(e){return[{value:"Server Instance",id:"server-instance",depth:3},{value:"Service Binding",id:"service-binding",depth:3},{value:"Adding Middleware",id:"adding-middleware",depth:3},{value:"Certificates and Startup",id:"certificates-and-startup",depth:3},{value:"Service Shutdown",id:"service-shutdown",depth:3}]}let d=(0,n.c)(function(e){let{toc:i=useTOC(e)}=e,r=Object.assign({h1:"h1",p:"p",code:"code",h3:"h3",a:"a",pre:"pre",span:"span",ul:"ul",li:"li"},(0,a.a)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h1,{children:"Server"}),"\n",(0,s.jsxs)(r.p,{children:["The Server is one of the core features of ",(0,s.jsx)(r.code,{children:"gRPCity"}),", providing the ability to manage the server lifecycle.\nIt offers a range of interface functions for managing the entire lifecycle, from importing certificates, binding services, supporting middleware, starting services, and shutting down services."]}),"\n",(0,s.jsx)(r.h3,{id:i[0].id,children:i[0].value}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"channelOptions"})," are explained in detail in the ",(0,s.jsx)(r.a,{href:"/guide/config",children:"Config guide"}),"."]}),"\n",(0,s.jsx)(r.pre,{"data-language":"javascript","data-copy":"",children:(0,s.jsxs)(r.code,{children:[(0,s.jsx)(r.span,{children:(0,s.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"// Get a server instance"})}),"\n",(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"const"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" server"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" ="}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" loader."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"initServer"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(channelOptions)"})]})]})}),"\n",(0,s.jsxs)(r.p,{children:["Once you have the ",(0,s.jsx)(r.code,{children:"server"})," instance, it offers a series of interfaces to help you develop services."]}),"\n",(0,s.jsx)(r.h3,{id:i[1].id,children:i[1].value}),"\n",(0,s.jsxs)(r.p,{children:["Service binding requires two parameters: ",(0,s.jsx)(r.code,{children:"service"})," and ",(0,s.jsx)(r.code,{children:"implementation"}),"."]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"service"}),": (required) Obtain the specified ",(0,s.jsx)(r.code,{children:"service"})," from the proto file using ",(0,s.jsx)(r.code,{children:"loader.service(name)"}),"."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"implementation"}),": (required) An object or class that carries the methods defined by the service RPC. You need to ",(0,s.jsx)(r.code,{children:"async"}),"ify it using ",(0,s.jsx)(r.code,{children:"loader.callbackify()"})," and add support for middleware."]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{"data-language":"javascript","data-copy":"",children:(0,s.jsxs)(r.code,{children:[(0,s.jsx)(r.span,{children:(0,s.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"// Bind service RPC"})}),"\n",(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"addService"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(service, implementation)"})]}),"\n",(0,s.jsx)(r.span,{children:(0,s.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"// Unbind service RPC"})}),"\n",(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"removeService"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(service)"})]})]})}),"\n",(0,s.jsx)(r.h3,{id:i[2].id,children:i[2].value}),"\n",(0,s.jsxs)(r.p,{children:["A distinctive feature of ",(0,s.jsx)(r.code,{children:"gRPCity"})," Server is that it provides middleware capabilities for pre- and post-processing of ",(0,s.jsx)(r.code,{children:"implementation"}),". For more details, see the ",(0,s.jsx)(r.a,{href:"/guide/middleware",children:"Middleware guide"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Note: Only service RPCs bound using ",(0,s.jsx)(r.code,{children:"loader.callbackify()"})," support middleware."]}),"\n",(0,s.jsx)(r.pre,{"data-language":"javascript","data-copy":"",children:(0,s.jsxs)(r.code,{children:[(0,s.jsx)(r.span,{children:(0,s.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"// Middleware support for implementation"})}),"\n",(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"addMiddleware"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(fn)"})]}),"\n",(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"addMiddlewares"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(fns)"})]})]})}),"\n",(0,s.jsx)(r.h3,{id:i[3].id,children:i[3].value}),"\n",(0,s.jsxs)(r.p,{children:["To start the service, the ",(0,s.jsx)(r.code,{children:"listen"})," function supports two parameters: ",(0,s.jsx)(r.code,{children:"addr"})," and ",(0,s.jsx)(r.code,{children:"credentials"}),":"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"addr"}),": (required) The address and port on which the service needs to listen. You can provide either of the following, either as a string or as an object (choose one):","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["string: in the format ",(0,s.jsx)(r.code,{children:"ip+port"}),", such as ",(0,s.jsx)(r.code,{children:"127.0.0.1:9099"}),";"]}),"\n",(0,s.jsxs)(r.li,{children:["object: ",(0,s.jsx)(r.code,{children:"{ host, port }"}),":","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"host: a string, supports both IP addresses and domain names;"}),"\n",(0,s.jsx)(r.li,{children:"port: a number, with a minimum value of 0 and a maximum value of 65535;"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"credentials"}),": (optional) Generated using ",(0,s.jsx)(r.code,{children:"makeServerCredentials"})," and provided to the ",(0,s.jsx)(r.code,{children:"listen"})," call."]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{"data-language":"javascript","data-copy":"",children:(0,s.jsxs)(r.code,{children:[(0,s.jsx)(r.span,{children:(0,s.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"// Server credentials"})}),"\n",(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"const"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" credentials"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" ="}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"makeServerCredentials"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(rootCerts, keyCertPairs, checkClientCertificate)"})]}),"\n",(0,s.jsx)(r.span,{children:(0,s.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"// Start the service"})}),"\n",(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"await"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"listen"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(addr, credentials)"})]}),"\n",(0,s.jsx)(r.span,{children:(0,s.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"// await server.listen('127.0.0.1:9099', credentials)"})}),"\n",(0,s.jsx)(r.span,{children:(0,s.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"// await server.listen({ host: '127.0.0.1', port: 9099 }, credentials)"})})]})}),"\n",(0,s.jsxs)(r.p,{children:["For more information, you can read the ",(0,s.jsx)(r.a,{href:"/guide/credentials",children:"Credentials guide"}),"."]}),"\n",(0,s.jsx)(r.h3,{id:i[4].id,children:i[4].value}),"\n",(0,s.jsxs)(r.p,{children:["Use ",(0,s.jsx)(r.code,{children:"shutdown()"})," with ",(0,s.jsx)(r.code,{children:"async"})," to ensure that it completes asynchronously, while ",(0,s.jsx)(r.code,{children:"forceShutdown"})," doesn't require ",(0,s.jsx)(r.code,{children:"async"}),"."]}),"\n",(0,s.jsx)(r.pre,{"data-language":"javascript","data-copy":"",children:(0,s.jsxs)(r.code,{children:[(0,s.jsx)(r.span,{children:(0,s.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"// Graceful service shutdown"})}),"\n",(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"await"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"shutdown"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"()"})]}),"\n",(0,s.jsx)(r.span,{children:(0,s.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"// Forceful service shutdown"})}),"\n",(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"forceShutdown"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"()"})]})]})})]})},"/en-US/guide/server",{filePath:"pages/en-US/guide/server.mdx",timestamp:1699236606e3,pageMap:t.v,frontMatter:{},title:"Server"},"undefined"==typeof RemoteContent?useTOC:RemoteContent.useTOC);function HOC(e){return d(e)}},1054:function(e,i,r){"use strict";r.d(i,{v:function(){return s}});let s=[{data:{index:"Home",start:"Get Started",guide:"User Guide",apis:"API"}},{name:"apis",route:"/en-US/apis",children:[{data:{grpcloader:"gRPC Loader",server:"Server","client-proxy":"Client Proxy"}},{name:"client-proxy",route:"/en-US/apis/client-proxy",frontMatter:{sidebar_label:"Client Proxy"}},{name:"grpcloader",route:"/en-US/apis/grpcloader",frontMatter:{sidebar_label:"Grpcloader"}},{name:"server",route:"/en-US/apis/server",frontMatter:{sidebar_label:"Server"}}]},{name:"apis",route:"/en-US/apis",frontMatter:{sidebar_label:"Apis"}},{name:"guide",route:"/en-US/guide",children:[{data:{loader:"Loader",config:"Config",server:"Server",client:"Client",metadata:"Metadata","stream-v2":"Stream v2",stream:"Stream",credentials:"Credentials",status:"Status",error:"Error",middleware:"Middleware",proto:"Proto"}},{name:"client",route:"/en-US/guide/client",frontMatter:{sidebar_label:"Client"}},{name:"config",route:"/en-US/guide/config",frontMatter:{sidebar_label:"Config"}},{name:"credentials",route:"/en-US/guide/credentials",frontMatter:{sidebar_label:"Credentials"}},{name:"error",route:"/en-US/guide/error",frontMatter:{sidebar_label:"Error"}},{name:"loader",route:"/en-US/guide/loader",frontMatter:{sidebar_label:"Loader"}},{name:"metadata",route:"/en-US/guide/metadata",frontMatter:{sidebar_label:"Metadata"}},{name:"middleware",route:"/en-US/guide/middleware",frontMatter:{sidebar_label:"Middleware"}},{name:"proto",route:"/en-US/guide/proto",frontMatter:{sidebar_label:"Proto"}},{name:"server",route:"/en-US/guide/server",frontMatter:{sidebar_label:"Server"}},{name:"status",route:"/en-US/guide/status",frontMatter:{sidebar_label:"Status"}},{name:"stream-v2",route:"/en-US/guide/stream-v2",frontMatter:{sidebar_label:"Stream V2"}},{name:"stream",route:"/en-US/guide/stream",frontMatter:{sidebar_label:"Stream"}}]},{name:"guide",route:"/en-US/guide",frontMatter:{sidebar_label:"Guide"}},{name:"index",route:"/en-US",frontMatter:{sidebar_label:"Index"}},{name:"start",route:"/en-US/start",children:[{data:{"proto-loader":"Proto Loader",server:"Server Side",client:"Client Side"}},{name:"client",route:"/en-US/start/client",frontMatter:{sidebar_label:"Client"}},{name:"proto-loader",route:"/en-US/start/proto-loader",frontMatter:{sidebar_label:"Proto Loader"}},{name:"server",route:"/en-US/start/server",frontMatter:{sidebar_label:"Server"}}]},{name:"start",route:"/en-US/start",frontMatter:{sidebar_label:"Start"}}]}},function(e){e.O(0,[7812,9774,2888,179],function(){return e(e.s=2024)}),_N_E=e.O()}]);