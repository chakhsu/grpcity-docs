(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9296],{9544:function(e,i,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/zh-CN/apis/server",function(){return r(611)}])},611:function(e,i,r){"use strict";r.r(i),r.d(i,{default:function(){return HOC},useTOC:function(){return useTOC}});var s=r(5893),n=r(7812),d=r(5493),l=r(8925),t=r(5192);function useTOC(e){return[{value:"addService()",id:"addservice",depth:3},{value:"removeService()",id:"removeservice",depth:3},{value:"makeServerCredentials()",id:"makeservercredentials",depth:3},{value:"addMiddleware()",id:"addmiddleware",depth:3},{value:"addMiddlewares()",id:"addmiddlewares",depth:3},{value:"listen()",id:"listen",depth:3},{value:"shutdown()",id:"shutdown",depth:3},{value:"forceShutdown()",id:"forceshutdown",depth:3}]}let a=(0,n.c)(function(e){let{toc:i=useTOC(e)}=e,r=Object.assign({h1:"h1",p:"p",code:"code",pre:"pre",span:"span",h3:"h3",strong:"strong",ul:"ul",li:"li"},(0,l.a)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h1,{children:"Server API"}),"\n",(0,s.jsxs)(r.p,{children:["通过调用",(0,s.jsx)(r.code,{children:"loader.initServer()"}),"获取",(0,s.jsx)(r.code,{children:"server"}),"实例，实例挂着一系列 API，方便我们去支持 gRPC Server 开发。"]}),"\n",(0,s.jsx)(r.pre,{icon:t.Dr,"data-language":"js","data-copy":"",children:(0,s.jsx)(r.code,{children:(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"const"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" server"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" ="}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" await"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" loader."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"initServer"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(channelOptions)"})]})})}),"\n",(0,s.jsx)(r.h3,{id:i[0].id,children:i[0].value}),"\n",(0,s.jsx)(r.pre,{icon:t.Dr,"data-language":"js","data-copy":"",children:(0,s.jsx)(r.code,{children:(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"addService"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(service, implementation)"})]})})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"功能说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["将",(0,s.jsx)(r.code,{children:"proto service rpc"}),"定义与具体的执行实现进行绑定。"]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"参数说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"service"}),": (必填) 需要通过",(0,s.jsx)(r.code,{children:"loader.service(name)"}),"来获取 proto 里指定的",(0,s.jsx)(r.code,{children:"service"}),"；"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"implementation"}),": (必填) 携带 service rpc 定义好的方法的对象或者类，需要通过",(0,s.jsx)(r.code,{children:"loader.callbackify()"}),"来",(0,s.jsx)(r.code,{children:"async"}),"化，并支持中间件；"]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"返回值:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"void: 空。"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:i[1].id,children:i[1].value}),"\n",(0,s.jsx)(r.pre,{icon:t.Dr,"data-language":"js","data-copy":"",children:(0,s.jsx)(r.code,{children:(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"removeService"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(service)"})]})})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"功能说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["对已经绑定的",(0,s.jsx)(r.code,{children:"service"}),"进行解绑。"]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"参数说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"service"}),": (必填) 需要通过",(0,s.jsx)(r.code,{children:"loader.service(name)"}),"来获取 proto 里指定的",(0,s.jsx)(r.code,{children:"service"}),"；"]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"返回值:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"void: 空。"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:i[2].id,children:i[2].value}),"\n",(0,s.jsx)(r.pre,{icon:t.Dr,"data-language":"js","data-copy":"",children:(0,s.jsx)(r.code,{children:(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"const"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" credentials"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" ="}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"makeServerCredentials"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(rootCerts, keyCertPairs, checkClientCertificate)"})]})})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"功能说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"1"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"参数说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"rootCerts"}),": (可选) Buffer, 一般为 ca 文件；"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"keyCertPairs"}),": 证书对，key和crt，必须数组；","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"private_key"}),": (可选) Buffer, 一般为 key 文件；"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"cert_chain"}),": (可选) Buffer, 一般为 crt 文件；"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"checkClientCertificate"}),": (可选) 是否检查客户端证书；"]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"返回值:"})}),"\n",(0,s.jsx)(r.p,{children:"存在两种情况:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["如果有完整的参数，则返回:",(0,s.jsx)(r.code,{children:"grpc.ServerCredentials.createSsl()"}),"；"]}),"\n",(0,s.jsxs)(r.li,{children:["如果没有参数，则返回: ",(0,s.jsx)(r.code,{children:"grpc.ServerCredentials.createInsecure()"}),"；"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:i[3].id,children:i[3].value}),"\n",(0,s.jsx)(r.pre,{icon:t.Dr,"data-language":"js","data-copy":"",children:(0,s.jsx)(r.code,{children:(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"addMiddleware"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(fn)"})]})})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"功能说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"添加一个处理 rpc 前后逻辑的中间件。"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"参数说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"fn"}),": (必选) 中间件函数，一般为",(0,s.jsx)(r.code,{children:"async (ctx, next) => { await next() }"})]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"返回值:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"void: 空。"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:i[4].id,children:i[4].value}),"\n",(0,s.jsx)(r.pre,{icon:t.Dr,"data-language":"js","data-copy":"",children:(0,s.jsx)(r.code,{children:(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"addMiddlewares"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(fns)"})]})})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"功能说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"添加多个处理 rpc 前后逻辑的中间件。"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"参数说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"fns"}),": (必选) 中间件函数数组，一般为",(0,s.jsx)(r.code,{children:"[ async (ctx, next) => { await next() } ]"})]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"返回值:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"void: 空。"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:i[5].id,children:i[5].value}),"\n",(0,s.jsx)(r.pre,{icon:t.Dr,"data-language":"js","data-copy":"",children:(0,s.jsx)(r.code,{children:(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"await"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"listen"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(addr, credentials)"})]})})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"功能说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"监听地址与端口，启动 gRPC 服务。"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"参数说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"addr"}),": (必选) 服务启动需要监听的地址和端口，支持类型如下，任选一个:","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["string: ip+port 格式，如 ",(0,s.jsx)(r.code,{children:"127.0.0.1:9099"}),"；"]}),"\n",(0,s.jsxs)(r.li,{children:["object: ",(0,s.jsx)(r.code,{children:"{ host, port }"}),"；","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"host: 字符串，支持 ip 和域名；"}),"\n",(0,s.jsx)(r.li,{children:"port: 数字，最小值为0，最大值为65535；"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"credentials"}),": (可选) 使用",(0,s.jsx)(r.code,{children:"makeServerCredentials"}),"来生成，并给",(0,s.jsx)(r.code,{children:"listen"}),"调用；"]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"返回值:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"void: 空。"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:i[6].id,children:i[6].value}),"\n",(0,s.jsx)(r.pre,{icon:t.Dr,"data-language":"js","data-copy":"",children:(0,s.jsx)(r.code,{children:(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"await"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"shutdown"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"()"})]})})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"功能说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"gRPC 服务优雅退出。"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"参数说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"void: 空。"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"返回值:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"void: 空。"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:i[7].id,children:i[7].value}),"\n",(0,s.jsx)(r.pre,{icon:t.Dr,"data-language":"js","data-copy":"",children:(0,s.jsx)(r.code,{children:(0,s.jsxs)(r.span,{children:[(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"server."}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"forceShutdown"}),(0,s.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"()"})]})})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"功能说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"gRPC 服务强制退出。"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"参数说明:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"void: 空。"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"返回值:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"void: 空。"}),"\n"]})]})},"/zh-CN/apis/server",{filePath:"pages/zh-CN/apis/server.mdx",timestamp:1699236606e3,pageMap:d.v,frontMatter:{},title:"Server API"},"undefined"==typeof RemoteContent?useTOC:RemoteContent.useTOC);function HOC(e){return a(e)}},5493:function(e,i,r){"use strict";r.d(i,{v:function(){return s}});let s=[{data:{index:"首页",start:"快速开始",guide:"用户指南",apis:"API"}},{name:"apis",route:"/zh-CN/apis",children:[{data:{grpcloader:"gRPC Loader",server:"Server","client-proxy":"Client Proxy"}},{name:"client-proxy",route:"/zh-CN/apis/client-proxy",frontMatter:{sidebar_label:"Client Proxy"}},{name:"grpcloader",route:"/zh-CN/apis/grpcloader",frontMatter:{sidebar_label:"Grpcloader"}},{name:"server",route:"/zh-CN/apis/server",frontMatter:{sidebar_label:"Server"}}]},{name:"apis",route:"/zh-CN/apis",frontMatter:{sidebar_label:"Apis"}},{name:"guide",route:"/zh-CN/guide",children:[{data:{loader:"Loader",config:"Config",server:"Server",client:"Client",metadata:"Metadata","stream-v2":"Stream v2",stream:"Stream",credentials:"Credentials",status:"Status",error:"Error",middleware:"Middleware",proto:"Proto"}},{name:"client",route:"/zh-CN/guide/client",frontMatter:{sidebar_label:"Client"}},{name:"config",route:"/zh-CN/guide/config",frontMatter:{sidebar_label:"Config"}},{name:"credentials",route:"/zh-CN/guide/credentials",frontMatter:{sidebar_label:"Credentials"}},{name:"error",route:"/zh-CN/guide/error",frontMatter:{sidebar_label:"Error"}},{name:"loader",route:"/zh-CN/guide/loader",frontMatter:{sidebar_label:"Loader"}},{name:"metadata",route:"/zh-CN/guide/metadata",frontMatter:{sidebar_label:"Metadata"}},{name:"middleware",route:"/zh-CN/guide/middleware",frontMatter:{sidebar_label:"Middleware"}},{name:"proto",route:"/zh-CN/guide/proto",frontMatter:{sidebar_label:"Proto"}},{name:"server",route:"/zh-CN/guide/server",frontMatter:{sidebar_label:"Server"}},{name:"status",route:"/zh-CN/guide/status",frontMatter:{sidebar_label:"Status"}},{name:"stream-v2",route:"/zh-CN/guide/stream-v2",frontMatter:{sidebar_label:"Stream V2"}},{name:"stream",route:"/zh-CN/guide/stream",frontMatter:{sidebar_label:"Stream"}}]},{name:"guide",route:"/zh-CN/guide",frontMatter:{sidebar_label:"Guide"}},{name:"index",route:"/zh-CN",frontMatter:{sidebar_label:"Index"}},{name:"start",route:"/zh-CN/start",children:[{data:{"proto-loader":"Proto Loader",server:"Server Side",client:"Client Side"}},{name:"client",route:"/zh-CN/start/client",frontMatter:{sidebar_label:"Client"}},{name:"proto-loader",route:"/zh-CN/start/proto-loader",frontMatter:{sidebar_label:"Proto Loader"}},{name:"server",route:"/zh-CN/start/server",frontMatter:{sidebar_label:"Server"}}]},{name:"start",route:"/zh-CN/start",frontMatter:{sidebar_label:"Start"}}]}},function(e){e.O(0,[7812,9774,2888,179],function(){return e(e.s=9544)}),_N_E=e.O()}]);